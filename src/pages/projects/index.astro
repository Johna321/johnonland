---
import { getCollection } from 'astro:content';
import ArticleLayout from '../../layouts/ArticleLayout.astro';

const projects = await getCollection('projects', ({ data }) => !data.draft);
const articles = projects
  .filter(p => p.slug !== 'index')
  .sort((a, b) => {
    const dateA = a.data.date?.getTime() || 0;
    const dateB = b.data.date?.getTime() || 0;
    return dateB - dateA;
  });

const indexEntry = projects.find(p => p.slug === 'index');
const IndexContent = indexEntry ? (await indexEntry.render()).Content : null;
const title = indexEntry?.data.title || 'Projects';
---

<ArticleLayout title={title} collection="projects" slug="index" headings={[]}>
  {IndexContent && (
    <div class="description">
      <IndexContent />
    </div>
  )}

  {articles.length > 0 && (
    <ul class="article-list">
      {articles.map((article) => (
        <li>
          <a href={`/projects/${article.slug}/`} class="internal">
            {article.data.title || article.slug}
          </a>
        </li>
      ))}
    </ul>
  )}
</ArticleLayout>

<style>
  .description {
    margin-bottom: 2rem;
    color: var(--darkgray);
  }

  .article-list {
    list-style: none;
    padding: 0;
  }

  .article-list li {
    margin-bottom: 0.5rem;
  }
</style>
